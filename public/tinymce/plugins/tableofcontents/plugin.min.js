// tinymce.PluginManager.add("tableofcontents",(e,t)=>{let l=()=>{let t=e.getContent(),l=document.createElement("div");l.className="mce-toc",l.innerHTML="<h2>Table of Contents</h2>";let n=document.createElement("ul"),a,d;return t.replace(/<(h[1-3])([^>]*)>(.*?)<\/\1>/gi,(t,l,i,r)=>{let c=i.match(/id="([^"]+)"/),o=c?c[1]:r.trim().toLowerCase().replace(/\s+/g,"-");o&&!i.includes(`id="${o}"`)&&e.dom.setAttrib(e.dom.select(l)[0],"id",o);let p=document.createElement("li");if(p.innerHTML=`<a href="#${o}">${r}</a>`,"h1"===l)a=p,n.appendChild(a),d=null;else if("h2"===l){a||(a=document.createElement("li"),n.appendChild(a));let h=a.querySelector("ul")||document.createElement("ul");h.appendChild(p),a.appendChild(h),d=p}else if("h3"===l){if(!d){d=document.createElement("li"),a||(a=document.createElement("li"),n.appendChild(a));let m=a.querySelector("ul")||document.createElement("ul");m.appendChild(d),a.appendChild(m)}let s=d.querySelector("ul")||document.createElement("ul");s.appendChild(p),d.appendChild(s)}}),l.appendChild(n),l.outerHTML},n=()=>{let t=l(),n=e.dom.select(".mce-toc");n.length?e.dom.setHTML(n[0],t):e.insertContent(t)};e.ui.registry.addMenuItem("tableofcontents",{text:"Table of contents",icon:"unordered-list",onAction(){n()}})});


tinymce.PluginManager.add("tableofcontents",(e,t)=>{let l=()=>{let t=e.getContent(),l=document.createElement("div");l.className="mce-toc",l.id="toc",l.innerHTML="<h2>Table of Contents</h2>";let n=document.createElement("ol"),d=0,a=0,i=0,o=!1;return t.replace(/<(h[1-3])([^>]*)>(.*?)<\/\1>/gi,(t,l,r,c)=>{let p=r.match(/id="([^"]+)"/),s=p?p[1]:c.trim().toLowerCase().replace(/\s+/g,"-");s&&!r.includes(`id="${s}"`)&&e.dom.setAttrib(e.dom.select(l)[0],"id",s);let h=document.createElement("li");if(h.innerHTML=`<a href="#${s}">${c}</a>`,"h1"===l)d+=1,a=0,i=0,h.prepend(document.createTextNode(`${d}. `)),n.appendChild(h),o=!0;else if("h2"===l){if(a+=1,i=0,o){if(o){let C=n.lastChild.querySelector("ol")||document.createElement("ol");h.prepend(document.createTextNode(`${d}.${a} `)),C.appendChild(h),n.lastChild.appendChild(C)}}else h.prepend(document.createTextNode(`${a}. `)),n.appendChild(h)}else if("h3"===l){i+=1;let m=n.lastChild.querySelector("ol");if(m){let f=m.lastChild.querySelector("ol")||document.createElement("ol");h.prepend(document.createTextNode(`${d}.${a}.${i} `)),f.appendChild(h),m.lastChild.appendChild(f)}}}),l.appendChild(n),l.outerHTML},n=()=>{let t=l(),n=e.dom.select(".mce-toc");n.length?e.dom.setHTML(n[0],t):e.insertContent(t)};e.ui.registry.addMenuItem("tableofcontents",{text:"Table of contents",icon:"unordered-list",onAction(){n()}})});