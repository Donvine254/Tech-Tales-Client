tinymce.PluginManager.add("tableofcontents",(e,t)=>{let l=()=>{let t=e.getContent(),l=document.createElement("div");l.className="mce-toc",l.innerHTML="<h2>Table of Contents</h2>";let n=document.createElement("ul"),a,d;return t.replace(/<(h[1-3])([^>]*)>(.*?)<\/\1>/gi,(t,l,i,r)=>{let c=i.match(/id="([^"]+)"/),o=c?c[1]:r.trim().toLowerCase().replace(/\s+/g,"-");o&&!i.includes(`id="${o}"`)&&e.dom.setAttrib(e.dom.select(l)[0],"id",o);let p=document.createElement("li");if(p.innerHTML=`<a href="#${o}">${r}</a>`,"h1"===l)a=p,n.appendChild(a),d=null;else if("h2"===l){a||(a=document.createElement("li"),n.appendChild(a));let h=a.querySelector("ul")||document.createElement("ul");h.appendChild(p),a.appendChild(h),d=p}else if("h3"===l){if(!d){d=document.createElement("li"),a||(a=document.createElement("li"),n.appendChild(a));let m=a.querySelector("ul")||document.createElement("ul");m.appendChild(d),a.appendChild(m)}let s=d.querySelector("ul")||document.createElement("ul");s.appendChild(p),d.appendChild(s)}}),l.appendChild(n),l.outerHTML},n=()=>{let t=l(),n=e.dom.select(".mce-toc");n.length?e.dom.setHTML(n[0],t):e.insertContent(t)};e.ui.registry.addMenuItem("tableofcontents",{text:"Table of contents",icon:"unordered-list",onAction(){n()}})});