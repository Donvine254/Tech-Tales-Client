tinymce.PluginManager.add("ai",function(e,t){let i=()=>{e.windowManager.open({title:"AI Assistant ✨",body:{type:"panel",items:[{type:"htmlpanel",name:"responsePanel",html:'<div id="ai-response-container" style="max-height:250px; overflow-y:scroll;"> </div>'},{type:"htmlpanel",name:"responseButtons",html:'<div id="response-buttons" style="display:none; margin:10px 0; flex-wrap:wrap;justify-content:space-between;align-items:center"><div><button id="insert-btn" style="background-color: #006CE7; color: white; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer;"> Insert</button> <button id="retry-btn" style="background-color: #f4f5f6; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer; margin-left:10px;">Try Again</button></div><p style="font-size:12px;">AI responses can be inaccurate</p></div'},{type:"input",name:"prompt",placeholder:"Ask AI to edit or brainstorm ideas"},{type:"htmlpanel",name:"attribution",html:`<p style="font-style:italic; color:#c2c2c2; margin:auto; font-size: 12px;">Powered by <span style="background: linear-gradient(to right, blue, purple); -webkit-background-clip: text; color: transparent;">Gemini</span>✨</p>`},]},buttons:[{type:"cancel",text:"Close"},{type:"submit",name:"submitButton",text:"Send",buttonType:"primary"},],onSubmit(e){let t=e.getData();if(!t.prompt)return alert("Kindly enter a prompt first!"),!1;let i=document.querySelector(".tox-textfield");i.disabled=!0;let n=document.getElementById("ai-response-container"),r=document.getElementById("response-buttons");displayLoadingIndicator(),fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t.prompt})}).then(e=>e.json()).then(e=>{let t=`<div style="margin-bottom:5px;padding: 10px;">${e.message}
</div>`;n.style.border="1px solid #f2f3f4",n.style.borderRadius="5px",n.innerHTML=t,r.style.display="flex",document.getElementById("insert-btn").addEventListener("click",()=>{insertContent(e)}),document.getElementById("retry-btn").addEventListener("click",()=>{i.disabled=!1,n.innerHTML="",r.style.display="none"})}).catch(e=>{console.error("Error fetching AI response:",e),n.innerHTML=`<p style="color:red;">Failed to generate response. Try again later or check the error below. ${e}</p>`}),e.setData({prompt:""})}})};return e.ui.registry.addButton("ai",{icon:"ai",tooltip:"Ask AI",shortcut:"meta+J",onAction:function(){i()}}),e.ui.registry.addMenuItem("ai",{text:"AI Assistant",icon:"ai",onAction:function(){i()}}),{getMetadata:function(){return{name:"AI Assistant",url:"http://exampleplugindocsurl.com"}}}});const insertContent=e=>{console.log(e),tinymce.activeEditor.insertContent(`<div>${e.message}</div>`),tinymce.activeEditor.windowManager.close()},displayLoadingIndicator=()=>{let e=document.getElementById("ai-response-container");e.innerHTML=`<div id="loading-indicator" style="width:100%; display:flex; flex-direction:column; gap:0.5rem;">
<div class="loading-bar" style="height:11px; width:100%; border-radius: 0.135rem; background: linear-gradient(to right, #4285f4, #242424,#4285f4); animation: gradientAnimation 3s linear infinite;"></div>
<div class="loading-bar" style="height:11px; width:100%; border-radius: 0.135rem; background: linear-gradient(to right, #4285f4, #242424,#4285f4); animation: gradientAnimation 3s linear infinite;"></div>
<div class="loading-bar" style="height:11px; width:100%; border-radius: 0.135rem; background: linear-gradient(to right, #4285f4, #242424,#4285f4); animation: gradientAnimation 3s linear infinite;"></div>
<div class="loading-bar" style="height:11px; width:70%; border-radius: 0.135rem; background: linear-gradient(to right, #4285f4, #242424,#4285f4); animation: gradientAnimation 3s linear infinite;"></div>
</div>`};