const giphyApiKey="kyOZdQ3OjsRHw1o8kp34h6FRvzyP3Div",randomApiUrl=`https://api.giphy.com/v1/gifs/trending?api_key=${giphyApiKey}&limit=50&offset=${Math.floor(100*Math.random())}&rating=g`;tinymce.PluginManager.add("gif",(e,t)=>{let i=()=>e.windowManager.open({title:"Insert GIF",body:{type:"panel",items:[{type:"input",name:"gifSearch",label:"Search GIFs"},{type:"htmlpanel",name:"gifDisplay",html:`<div><p style="display:flex; justify-content:flex-end; align-items:center; font-size: 14px; color: #888; gap:5px;">Powered By <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Giphy-logo.svg" width="50" alt="giphy-attribution" style="width:50px;"/></p><div id="gifGrid" class="gif-grid-container" style="display: grid; grid-template-columns: repeat(2, 1fr); justify-content: center; align-items: center; width: 100%; gap: 10px;">
<p style="color: #888;width:100%; text-align: center;">Loading...</p>
</div> </div>`},]},buttons:[{type:"cancel",text:"Close"},{type:"submit",text:"Search",buttonType:"primary"},],onSubmit(e){let t=e.getData(),i=t.gifSearch;if(i){let r=`https://api.giphy.com/v1/gifs/search?api_key=${giphyApiKey}&q=${encodeURIComponent(i)}&limit=20&rating=g`;fetch(r).then(e=>e.json()).then(e=>{let t=document.getElementById("gifGrid");t.innerHTML="",e.data.length>0?e.data.forEach((e,i)=>{let r=e.images.fixed_height.url,n=`<div style="margin:5px"><img src="${r}" key="${i}" id="${i}"style="cursor:pointer; object-fit: cover; width: 150px; height: 150px;" onclick="insertGif(event,'${r}')"/></div>`;t.innerHTML+=n}):t.innerHTML="<p>No GIFs found for that search term.</p>"}).catch(e=>{console.error("Error fetching search results:",e),alert("Error fetching search results. Please try again.")})}else alert("Please enter a search term.")}});return e.ui.registry.addIcon("gif",`<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7h6v2H3v6h4v-2H5v-2h4v6H1V7h2zm14 0h6v2h-6v2h4v2h-4v4h-2V7h2zm-4 0h-2v10h2V7z" fill="#000000"/>
   </svg>`),e.ui.registry.addButton("gif",{icon:"gif",tooltip:"Insert a GIF",onAction(){i(),fetch(randomApiUrl).then(e=>e.json()).then(e=>{let t=document.getElementById("gifGrid");t.innerHTML="",e.data.forEach((e,i)=>{let r=e.images.fixed_height.url,n=`<div style="margin:5px"><img src="${r}" key="${i}" id="${i}"style="cursor:pointer; object-fit: cover; width: 150px; height: 150px;" onclick="insertGif(event,'${r}')"/></div>`;t.innerHTML+=n})}).catch(e=>{console.error("Error fetching random GIFs:",e),alert("Error loading random GIFs.")})}}),e.ui.registry.addMenuItem("gif",{text:"GIF plugin",icon:"gif",onAction(){i()}}),{getMetadata:()=>({name:"GIF plugin",url:"http://exampleplugindocsurl.com"})}}),insertGif=(e,t)=>{e.preventDefault(),tinymce.activeEditor.insertContent(`<img src="${t}" alt="GIF" role="presentation" loading="lazy" />`),tinymce.activeEditor.windowManager.close()};