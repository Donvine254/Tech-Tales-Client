const giphyApiKey="kyOZdQ3OjsRHw1o8kp34h6FRvzyP3Div",randomApiUrl=`https://api.giphy.com/v1/gifs/trending?api_key=${giphyApiKey}&limit=60&offset=${Math.floor(100*Math.random())}&rating=g`;let handleSubmit;tinymce.PluginManager.add("gif",(e,t)=>{let i=()=>e.windowManager.open({title:"Insert GIF",body:{type:"panel",items:[{type:"htmlpanel",name:"gifDisplay",html:`<div><form onsubmit="handleSubmit(event)">
<div style="display:flex; align-items:center; gap: 0;">
 <input type="search" placeholder="Search GIFs..." name="gifSearch" id="gifSearch" style="width:100%; border-radius:5px 0 0 5px; padding: 8px 5px; border: 1px solid #006ce7" onmouseover="this.style.borderColor='#00308F';" onmouseout="this.style.borderColor='#006ce7';" autofocus/><button style="background-color: #006ce7; color:white; padding: 8px 10px; outline:none; border:1px solid #006ce7; border-radius:0 5px 5px 0; cursor:pointer;" id="searchBtn" onclick="handleSubmit(event)" title="search" type="submit">Search</button>
</div><p style="display:flex; justify-content:flex-end; align-items:center; font-size: 14px; color: #888; gap:5px;">
 Powered By <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Giphy-logo.svg" width="50" alt="giphy-attribution" style="width:50px;"/>
</p></form><div id="loader" style="display:flex; align-items-center;justify-content:center; flex-direction:column;gap:10px;"> <svg xmlns="http://www.w3.org/2000/svg" style="margin: auto; background: none; display: block;" width="30px" height="30px" viewBox="0 0 100 100"><circle cx="50" cy="50" r="35" stroke-width="8" stroke="#888" stroke-dasharray="164 56" fill="none" stroke-linecap="round">
<animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50"/> </circle>
</svg> <p style="color: #888;text-align:center;">Loading GIFs...</p></div>
<div id="gifGrid" class="gif-grid-container" style="display: grid; grid-template-columns: repeat(3,1fr); justify-content: center; align-items: center; max-width: 100%; max-height: 100vh; gap: 10px; overflow-x:clip;">
</div> </div>`}]},buttons:[{type:"cancel",text:"Close"}]});return handleSubmit=e=>{e.preventDefault();let t=document.getElementById("gifSearch").value;if(t){let i=`https://api.giphy.com/v1/gifs/search?api_key=${giphyApiKey}&q=${encodeURIComponent(t)}&limit=30&rating=g`;fetch(i).then(e=>e.json()).then(e=>{let t=document.getElementById("gifGrid");t.innerHTML="",e.data.length>0?e.data.forEach((e,i)=>{let r=e.images.fixed_height.url,n=`<div style="position: relative; width: 100%; padding-top: 100%; border:1px solid #ccc; background-image: url('https://res.cloudinary.com/dipkbpinx/image/upload/v1727994385/illustrations/simx3zvhnukfaaix2isp.gif'); background-position:center; background-repeat:no-repeat; background-size: contain;" onclick="insertGif('${r}')"> <img src="${r}" key="${i}" id="${i}" style="cursor:pointer; object-fit: cover; position: absolute; top: 0; left: 0; width: 100%; height: 100%;" />
</div>`;t.innerHTML+=n}):t.innerHTML=`<p style='width:100%; text-align:center;'>No GIFs found ðŸ˜¢.</p>`}).catch(e=>{console.error("Error fetching search results:",e),alert("Error fetching search results. Please try again.")})}else alert("Please enter a search term.")},insertGif=t=>{e.setProgressState(!0),e.insertContent(`<img src="${t}" alt="GIF" role="presentation" loading="lazy" />`),e.windowManager.close(),setTimeout(()=>{e.setProgressState(!1)},1e3)},e.ui.registry.addIcon("gif",`<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7h6v2H3v6h4v-2H5v-2h4v6H1V7h2zm14 0h6v2h-6v2h4v2h-4v4h-2V7h2zm-4 0h-2v10h2V7z" fill="#000000"/>
</svg>`),e.ui.registry.addButton("gif",{icon:"gif",tooltip:"Insert a GIF",onAction(){i(),fetch(randomApiUrl).then(e=>e.json()).then(e=>{let t=document.getElementById("gifGrid");t.innerHTML="",e.data.forEach((e,i)=>{let r=e.images.fixed_height.url,n=`<div style="position: relative; width: 100%; padding-top: 100%; border:1px solid #ccc; background-image: url('https://res.cloudinary.com/dipkbpinx/image/upload/v1727994385/illustrations/simx3zvhnukfaaix2isp.gif'); background-position:center; background-repeat:no-repeat; background-size: contain;" onclick="insertGif(event, '${r}')"><img src="${r}" key="${i}" id="${i}" style="cursor:pointer; object-fit: cover; position: absolute; top: 0; left: 0; width: 100%; height: 100%;" />
</div>`;t.innerHTML+=n,document.getElementById("loader").innerHTML=""})}).catch(e=>{console.error("Error fetching random GIFs:",e),alert("Error loading random GIFs.")})}}),e.ui.registry.addMenuItem("gif",{text:"GIF plugin",icon:"gif",onAction(){i()}}),{getMetadata:()=>({name:"GIF plugin",url:"http://exampleplugindocsurl.com"})}});